<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªæ—çµäºº 2.0 - éºå¿˜æ›²ç·šç‰¹è¨“</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #2d4a22; --bg: #fdfaf5; --accent: #c66b3d; --card: #ffffff; --wrong: #c62828; }
        body { font-family: "Noto Sans TC", sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        #app { width: 100%; max-width: 450px; }
        .card { background: var(--card); padding: 30px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .badge { background: var(--accent); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; margin-bottom: 10px; display: inline-block; }
        h1 { color: var(--primary); font-size: 1.4rem; margin: 10px 0 20px 0; text-align: center; }
        .question { font-size: 1.25rem; color: #333; line-height: 1.6; margin-bottom: 25px; font-weight: 600; }
        .options { display: grid; gap: 12px; }
        button.opt-btn { padding: 16px; border: 1.5px solid #ddd; border-radius: 15px; background: white; font-size: 1.1rem; cursor: pointer; transition: 0.2s; text-align: left; }
        button.opt-btn:hover { border-color: var(--primary); background: #f0f4ef; }
        #feedback { margin-top: 20px; padding: 15px; border-radius: 12px; display: none; }
        .correct { background: #e8f5e9; color: #2e7d32; }
        .wrong { background: #ffebee; color: var(--wrong); }
        .review-alert { background: #fff3e0; border: 1px dashed #ffb74d; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; color: #e65100; cursor: pointer; }
        #next-btn { width: 100%; padding: 16px; margin-top: 20px; border-radius: 15px; border: none; background: var(--primary); color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; display: none; }
    </style>
</head>
<body>
<div id="app">
    <div class="card">
        <div id="review-banner" class="review-alert" style="display:none;" onclick="startReviewMode()">
            ğŸ“¢ éºå¿˜æ›²ç·šæé†’ï¼šä½ æœ‰é¡ŒéŒ¯é¡Œè©²è¤‡ç¿’äº†ï¼<br><b>é»æ­¤é–‹å§‹ç‰¹è¨“</b>
        </div>
        
        <div id="game-ui">
            <div id="mode-badge" class="badge">å¸¸è¦æŒ‘æˆ°</div>
            <h1 id="title">ğŸ¹ èªæ—çµäºº</h1>
            <div class="question" id="q-text">è¼‰å…¥ä¸­...</div>
            <div class="options" id="opt-zone"></div>
            <div id="feedback"></div>
            <button id="next-btn">ä¸‹ä¸€é¡Œ â”</button>
        </div>
    </div>
</div>

<script>
    // é¡Œåº«å¢åŠ  ID (ç”¨æ–¼è¿½è¹¤)
    const allQuestions = [
        { id: "q1", q: "ã€Œæ‹šã€å‘½å·¥ä½œçš„è®€éŸ³ç‚ºä½•ï¼Ÿ", options: ["ã„†ã„¢Ë‹", "ã„†ã„§ã„£"], correct: "ã„†ã„¢Ë‹", note: "æ¨™æº–éŸ³ç‚ºã„†ã„¢Ë‹ã€‚" },
        { id: "q2", q: "ã€Œè‡ªæ€¨è‡ªè‰¾ã€çš„ã€Œè‰¾ã€è®€éŸ³ï¼Ÿ", options: ["ã„Ë‹", "ã„§Ë‹"], correct: "ã„§Ë‹", note: "æ„ç‚ºæ²»ç†ã€æ”¹æ­£ã€‚" },
        { id: "q3", q: "ã€Œç¨±ã€è·çš„è®€éŸ³ç‚ºä½•ï¼Ÿ", options: ["ã„”ã„¥Ë‹", "ã„”ã„¥"], correct: "ã„”ã„¥Ë‹", note: "ç›¸ç¨±ã€é©åˆæ™‚è®€å››è²ã€‚" },
        { id: "q4", q: "ã€Œå¡‘ã€è† çš„è®€éŸ³ç‚ºä½•ï¼Ÿ", options: ["ã„™ã„¨Ë‹", "ã„•ã„¨Ë‹"], correct: "ã„™ã„¨Ë‹", note: "éƒ¨é¦–æ˜¯åœŸï¼Œä¸æ˜¯æ–¹ã€‚" },
        { id: "q5", q: "ã€ŒæŒ‘ã€é‡çš„è®€éŸ³ç‚ºä½•ï¼Ÿ", options: ["ã„Šã„§ã„ Ë‡", "ã„Šã„§ã„ "], correct: "ã„Šã„§ã„ Ë‡", note: "æŒ‘æ’¥ã€æŒ‘é‡éƒ½è¦è®€ä¸‰è²ã€‚" }
    ];

    let currentQuestions = [...allQuestions];
    let currentIdx = 0;
    let isReviewMode = false;

    // åˆå§‹åŒ–ï¼šæª¢æŸ¥æ˜¯å¦æœ‰åˆ°æœŸçš„éŒ¯é¡Œ
    function init() {
        checkReviewNeeded();
        showQuestion();
    }

    function checkReviewNeeded() {
        const history = JSON.parse(localStorage.getItem('hunt_history')) || {};
        const now = Date.now();
        const dueIds = Object.keys(history).filter(id => now > history[id].nextReview);
        
        if (dueIds.length > 0) {
            document.getElementById('review-banner').style.display = "block";
            document.getElementById('review-banner').innerHTML = `ğŸ“¢ éºå¿˜æ›²ç·šæé†’ï¼šä½ æœ‰ ${dueIds.length} é¡Œè©²è¤‡ç¿’äº†ï¼<br><b>é»æ­¤é–‹å§‹ç‰¹è¨“</b>`;
        }
    }

    function startReviewMode() {
        const history = JSON.parse(localStorage.getItem('hunt_history')) || {};
        const now = Date.now();
        const dueIds = Object.keys(history).filter(id => now > history[id].nextReview);
        
        currentQuestions = allQuestions.filter(q => dueIds.includes(q.id));
        currentIdx = 0;
        isReviewMode = true;
        document.getElementById('mode-badge').innerText = "âš¡ éŒ¯é¡Œè¤‡ç¿’æ¨¡å¼";
        document.getElementById('review-banner').style.display = "none";
        showQuestion();
    }

    function showQuestion() {
        if (currentQuestions.length === 0) {
            document.getElementById('game-ui').innerHTML = "<h2>ğŸ‰ ç›®å‰æ²’æœ‰å¾…è¤‡ç¿’é¡Œç›®ï¼</h2><button onclick='location.reload()'>è¿”å›ä¸€èˆ¬æ¨¡å¼</button>";
            return;
        }
        const q = currentQuestions[currentIdx];
        document.getElementById('q-text').innerText = q.q;
        const optZone = document.getElementById('opt-zone');
        optZone.innerHTML = "";
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt);
            optZone.appendChild(btn);
        });
        document.getElementById('feedback').style.display = "none";
        document.getElementById('next-btn').style.display = "none";
    }

    function checkAnswer(selected) {
        const q = currentQuestions[currentIdx];
        const feedback = document.getElementById('feedback');
        const isCorrect = (selected === q.correct);
        
        updateHistory(q.id, isCorrect);

        if (isCorrect) {
            feedback.className = "correct";
            feedback.innerHTML = `ğŸ¯ ç­”å°äº†ï¼<br><small>${q.note}</small>`;
            confetti({ particleCount: 100, spread: 70 });
        } else {
            feedback.className = "wrong";
            feedback.innerHTML = `âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºæ˜¯ã€Œ${q.correct}ã€<br><small>${q.note}</small>`;
        }
        feedback.style.display = "block";
        document.getElementById('next-btn').style.display = "block";
        document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
    }

    function updateHistory(id, isCorrect) {
        let history = JSON.parse(localStorage.getItem('hunt_history')) || {};
        const intervals = [0, 1, 3, 7, 14, 30]; // å¤©æ•¸é–“éš”

        if (!history[id]) history[id] = { level: 0, nextReview: 0 };

        if (isCorrect) {
            // ç­”å°äº†ï¼Œæ‹‰é•·è¤‡ç¿’æ™‚é–“
            history[id].level = Math.min(history[id].level + 1, intervals.length - 1);
        } else {
            // ç­”éŒ¯äº†ï¼Œé‡å›ç­‰ç´š 1 (24å°æ™‚å¾Œè¤‡ç¿’)
            history[id].level = 1;
        }
        
        const nextDays = intervals[history[id].level];
        history[id].nextReview = Date.now() + (nextDays * 24 * 60 * 60 * 1000);
        
        localStorage.setItem('hunt_history', JSON.stringify(history));
    }

    document.getElementById('next-btn').onclick = () => {
        currentIdx++;
        if (currentIdx < currentQuestions.length) {
            showQuestion();
        } else {
            alert("æŒ‘æˆ°çµæŸï¼ç³»çµ±å·²æ›´æ–°ä½ çš„è¨˜æ†¶æ›²ç·šã€‚");
            location.reload();
        }
    };

    init();
</script>
</body>
</html>
