<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªæ—çµäºº 4.0 - åœ‹æ–‡åˆ†ç´šç‰¹è¨“</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #2d4a22; --pro: #5a4a78; --bg: #fdfaf5; --card: #ffffff; --accent: #c66b3d; }
        body { font-family: "Noto Sans TC", sans-serif; background-color: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        #app { width: 100%; max-width: 480px; }
        .card { background: var(--card); padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); position: relative; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 25px; font-size: 1.5rem; }
        
        /* é¸å–®ä»‹é¢ */
        .menu-section { margin-bottom: 20px; }
        .section-title { font-weight: bold; margin-bottom: 10px; color: #666; font-size: 0.9rem; border-left: 4px solid var(--accent); padding-left: 8px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .nav-btn { padding: 20px 10px; border: 1.5px solid #eee; border-radius: 16px; background: white; cursor: pointer; transition: 0.2s; text-align: center; }
        .nav-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: #ddd; }
        .nav-btn b { display: block; font-size: 1.1rem; margin-bottom: 5px; }
        .nav-btn small { color: #888; font-size: 0.8rem; }
        .btn-basic { border-bottom: 4px solid var(--primary); }
        .btn-pro { border-bottom: 4px solid var(--pro); }

        /* éŠæˆ²ä»‹é¢ */
        #game-ui { display: none; }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; color: white; margin-bottom: 10px; display: inline-block; }
        .question { font-size: 1.15rem; line-height: 1.6; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 15px; min-height: 100px; }
        .options { display: grid; gap: 12px; }
        .opt-btn { padding: 15px; border: 1px solid #ddd; border-radius: 12px; background: white; text-align: left; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .opt-btn:hover { background: #f0f4ef; }
        #feedback { margin-top: 20px; padding: 15px; border-radius: 12px; display: none; line-height: 1.5; }
        .correct { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .wrong { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        #next-btn { width: 100%; padding: 16px; margin-top: 20px; border-radius: 15px; border: none; background: #333; color: white; cursor: pointer; display: none; font-weight: bold; font-size: 1.1rem; }
        
        /* è¿”å›æŒ‰éˆ•æ¨£å¼ */
        .exit-link { display: block; text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #aaa; text-decoration: none; font-size: 0.85rem; transition: 0.2s; }
        .exit-link:hover { color: #666; }

        .review-alert { background: #fff3e0; border: 1px dashed #ffb74d; padding: 12px; border-radius: 12px; margin-bottom: 20px; text-align: center; color: #e65100; cursor: pointer; font-size: 0.9rem; }
    </style>
</head>
<body>
<div id="app">
    <div class="card">
        <div id="review-banner" class="review-alert" style="display:none;" onclick="startReviewMode()">
            ğŸ“¢ éºå¿˜æ›²ç·šæé†’ï¼šä½ æœ‰éŒ¯é¡Œè©²è¤‡ç¿’äº†ï¼é»æ­¤é–‹å§‹ã€‚
        </div>

        <div id="menu-ui">
            <h1>ğŸ¹ èªæ—çµäºº 4.0</h1>
            <div class="menu-section">
                <div class="section-title">åŸºç¤è¨“ç·´å€</div>
                <div class="grid">
                    <button class="nav-btn btn-basic" onclick="startLevel('basic_word')"><b>å½¢éŸ³ç¾©</b><small>åŸºç¤å­—è©ç·´ç¿’</small></button>
                    <button class="nav-btn btn-basic" onclick="startLevel('basic_reading')"><b>æ–‡æ„å•Ÿè’™</b><small>èªæ„Ÿèˆ‡æˆèª</small></button>
                </div>
            </div>
            <div class="menu-section">
                <div class="section-title">é«˜æ‰‹å¯¦æˆ°å€ (æ­·å±†è©¦é¡Œ)</div>
                <div class="grid">
                    <button class="nav-btn btn-pro" onclick="startLevel('pro_word')"><b>æœƒè€ƒå½¢éŸ³ç¾©</b><small>108-114æ­·å±†</small></button>
                    <button class="nav-btn btn-pro" onclick="startLevel('pro_reading')"><b>æœƒè€ƒé–±è®€</b><small>é•·æ–‡åˆ¤è®€ç‰¹è¨“</small></button>
                </div>
            </div>
        </div>

        <div id="game-ui">
            <div id="mode-badge" class="badge" style="background: #999;"></div>
            <div id="q-source" style="font-size: 0.8rem; color: #999; margin-bottom: 5px; float: right;"></div>
            <div class="question" id="q-text"></div>
            <div class="options" id="opt-zone"></div>
            <div id="feedback"></div>
            <button id="next-btn">ç¢ºèªä¸‹ä¸€æ­¥ â”</button>
            
            <a href="javascript:void(0)" class="exit-link" onclick="confirmExit()">âœ• æ”¾æ£„ç·´ç¿’ä¸¦è¿”å›é¦–é </a>
        </div>
    </div>
</div>

<script>
    const allQuestions = [
        // 1. åŸºç¤å½¢éŸ³ç¾©
        { id: "bw1", cat: "basic_word", q: "ã€Œæ‹šã€å‘½å·¥ä½œçš„è®€éŸ³ç‚ºä½•ï¼Ÿ", options: ["ã„†ã„¢Ë‹", "ã„†ã„§ã„£"], correct: "ã„†ã„¢Ë‹", note: "æ³¨æ„ï¼šæœƒè€ƒæ¨™æº–éŸ³ç‚ºå››è²ã„†ã„¢Ë‹ã€‚" },
        { id: "bw2", cat: "basic_word", q: "ã€Œè‡ªæ€¨è‡ªè‰¾ã€çš„ã€Œè‰¾ã€å­—è®€éŸ³ç‚ºä½•ï¼Ÿ", options: ["ã„Ë‹", "ã„§Ë‹"], correct: "ã„§Ë‹", note: "è‰¾ï¼šæ²»ç†ã€æ‚”æ”¹ä¹‹æ„ï¼Œè®€ã„§Ë‹ã€‚" },
        { id: "bw3", cat: "basic_word", q: "ä¸‹åˆ—å­—å½¢ä½•è€…æ­£ç¢ºï¼Ÿ", options: ["å†æ¥å†å²", "å†æ¥å†å‹µ"], correct: "å†æ¥å†å²", note: "å²ï¼šç£¨ç·´ã€ç²¾é€²ã€‚" },

        // 2. åŸºç¤æ–‡æ„
        { id: "br1", cat: "basic_reading", q: "ã€Œè‰¯è—¥è‹¦å£åˆ©æ–¼ç—…ï¼Œå¿ è¨€é€†è€³åˆ©æ–¼è¡Œã€‚ã€é€™å¥è©±å¼·èª¿ï¼Ÿ", options: ["æ¥å—å‹¸èª¡æœ‰åŠ©é€²æ­¥", "ç”Ÿç—…è¦åƒè—¥", "èªªè©±è¦å§”å©‰"], correct: "æ¥å—å‹¸èª¡æœ‰åŠ©é€²æ­¥", note: "å¿ å‘Šé›–ç„¶é›£è½ä½†æœ‰ç›Šè™•ã€‚" },

        // 3. é«˜æ‰‹æ­·å±†å½¢éŸ³ç¾© (113, 114P)
        { id: "pw1", cat: "pro_word", source: "113æœƒè€ƒ", q: "ä¸‹åˆ—æ–‡å¥ã€Œ ã€ä¸­çš„å­—ï¼Œä½•è€…è®€éŸ³æ­£ç¢ºï¼Ÿ", options: ["ã€Œå¡‘ã€è† ï¼šã„™ã„¨Ë‹", "ã€ŒçŒã€ä¸åŠé˜²ï¼šã„—ã„¨Ë‹", "ã€Œæ‚„ã€ç„¶é›¢å»ï¼šã„‘ã„§ã„ ", "ã€Œæ··ã€æ¿ï¼šã„ã„¨ã„£ËŠ"], correct: "ã€Œå¡‘ã€è† ï¼šã„™ã„¨Ë‹", note: "çŒ(ã„˜ã„¨Ë‹)ã€æ‚„(ã„‘ã„§ã„ Ë‡)ã€æ··(ã„ã„¨ã„£Ë‹)ã€‚" },
        { id: "pw2", cat: "pro_word", source: "114åƒè€ƒå·", q: "ä¸‹åˆ—å„çµ„ã€Œ ã€ä¸­çš„å­—ï¼Œä½•è€…è®€éŸ³æ­£ç¢ºï¼Ÿ", options: ["é‡ã€Œç ­ã€ï¼šã„…ã„§ã„¢", "å‹ã€Œèª¼ã€ï¼šã„§ËŠ", "ã€Œåª²ã€ç¾ï¼šã„…ã„§Ë‹", "è³„ã€Œè³‚ã€ï¼šã„Œã„¨Ë‹"], correct: "é‡ã€Œç ­ã€ï¼šã„…ã„§ã„¢", note: "èª¼(ã„§Ë‹)ã€åª²(ã„†ã„§Ë‹)ã€è³‚(ã„Œã„¨Ë‹)ã€‚" },

        // 4. é«˜æ‰‹æ­·å±†é–±è®€ (114P PDF)
        { id: "pr1", cat: "pro_reading", source: "114åƒè€ƒå·", q: "æ ¹æ“šæ–‡ä¸­æ–°ã€èˆŠã€Šäº”ä»£å²ã€‹å°å—å”å›ä¸»çš„è¨˜è¼‰ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æœ€æ°ç•¶ï¼Ÿ", options: ["ã€ŠèˆŠäº”ä»£å²ã€‹èªåŒå…¶æ­£çµ±åœ°ä½", "ã€Šæ–°äº”ä»£å²ã€‹ä¸æ‰¿èªåŒ—æ–¹æ”¿æ¬Š", "å—å”å›ä¸»åœ¨ã€ŠèˆŠäº”ä»£å²ã€‹çš„å®šä½æ¯”åœ¨ã€Šæ–°äº”ä»£å²ã€‹é«˜", "æ‰€æœ‰å²æ›¸çš†ç¨±å—å”å›ä¸»ç‚ºå¸"], correct: "å—å”å›ä¸»åœ¨ã€ŠèˆŠäº”ä»£å²ã€‹çš„å®šä½æ¯”åœ¨ã€Šæ–°äº”ä»£å²ã€‹é«˜", note: "èˆŠå²è¨˜æ–¼ã€Œä¸–å®¶ã€ï¼Œæ–°å²è¨˜æ–¼ã€Œè¼‰è¨˜ã€ï¼Œå±¤ç´šä¸åŒã€‚" },
        { id: "pr2", cat: "pro_reading", source: "114åƒè€ƒå·", q: "ã€Œå®‹æœæ»…äº†å—å”ï¼Œå¯æ˜¯æ±´äº¬çš‡åŸè£¡çš„æ–‡åŒ–è³‡ç”¢ï¼Œæœ‰å¤šå°‘ä¾†è‡ªå—å”å•Šï¼ã€æ­¤è©±ç”¨æ„ç‚ºä½•ï¼Ÿ", options: ["æ„Ÿå˜†å—å”åœ‹åŠ›ç©å¼±", "è‚¯å®šå—å”å°æ–‡åŒ–çš„è²¢ç»", "è«·åˆºå®‹æœç‡’æ®ºæ“„æ ", "ç¨±è®šå®‹æœå»ºç¯‰é›„å‰"], correct: "è‚¯å®šå—å”å°æ–‡åŒ–çš„è²¢ç»", note: "å¼·èª¿å—å”ä½œç‚ºæ–‡åŒ–é‡é®çš„æ·±é å½±éŸ¿ã€‚" }
    ];

    let currentSet = [];
    let currentIdx = 0;

    function init() {
        checkReviewNeeded();
    }

    function checkReviewNeeded() {
        const history = JSON.parse(localStorage.getItem('hunt_history')) || {};
        const now = Date.now();
        const dueIds = Object.keys(history).filter(id => now > history[id].nextReview);
        if (dueIds.length > 0) {
            document.getElementById('review-banner').style.display = "block";
            document.getElementById('review-banner').innerText = `ğŸ“¢ ç™¼ç¾ ${dueIds.length} é¡Œåˆ°æœŸéŒ¯é¡Œï¼Œé»æ­¤é€²å…¥è¤‡ç¿’ï¼`;
        }
    }

    function startLevel(category) {
        currentSet = allQuestions.filter(q => q.cat === category);
        if(currentSet.length === 0) { alert("æ­¤å€é¡Œåº«æ­£åœ¨æ¬é‹ä¸­ï¼Œè«‹å…ˆç·´ç¿’å…¶ä»–å€ï¼"); return; }
        setupGame(category);
    }

    function startReviewMode() {
        const history = JSON.parse(localStorage.getItem('hunt_history')) || {};
        const now = Date.now();
        const dueIds = Object.keys(history).filter(id => now > history[id].nextReview);
        currentSet = allQuestions.filter(q => dueIds.includes(q.id));
        setupGame("è¤‡ç¿’æ¨¡å¼");
    }

    function setupGame(modeName) {
        currentIdx = 0;
        document.getElementById('menu-ui').style.display = "none";
        document.getElementById('review-banner').style.display = "none";
        document.getElementById('game-ui').style.display = "block";
        
        const badge = document.getElementById('mode-badge');
        badge.innerText = modeName;
        badge.style.background = modeName.includes('pro') ? 'var(--pro)' : 'var(--primary)';
        
        showQuestion();
    }

    function showQuestion() {
        const q = currentSet[currentIdx];
        document.getElementById('q-source').innerText = q.source || "ç‰¹è¨“é¡Œ";
        document.getElementById('q-text').innerText = q.q;
        const optZone = document.getElementById('opt-zone');
        optZone.innerHTML = "";
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt);
            optZone.appendChild(btn);
        });
        document.getElementById('feedback').style.display = "none";
        document.getElementById('next-btn').style.display = "none";
    }

    function checkAnswer(selected) {
        const q = currentSet[currentIdx];
        const feedback = document.getElementById('feedback');
        const isCorrect = selected === q.correct;
        
        // ç´€éŒ„éºå¿˜æ›²ç·š
        updateHistory(q.id, isCorrect);

        feedback.className = isCorrect ? "correct" : "wrong";
        feedback.innerHTML = isCorrect ? `ğŸ¯ ç­”å°äº†ï¼<br><small>${q.note}</small>` : `âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${q.correct}ã€<br><small>${q.note}</small>`;
        feedback.style.display = "block";
        document.getElementById('next-btn').style.display = "block";
        
        if(isCorrect) confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
    }

    function updateHistory(id, isCorrect) {
        let history = JSON.parse(localStorage.getItem('hunt_history')) || {};
        const intervals = [0, 1, 3, 7, 14, 30]; 
        if (!history[id]) history[id] = { level: 0, nextReview: 0 };
        if (isCorrect) {
            history[id].level = Math.min(history[id].level + 1, intervals.length - 1);
        } else {
            history[id].level = 1;
        }
        const nextDays = intervals[history[id].level];
        history[id].nextReview = Date.now() + (nextDays * 24 * 60 * 60 * 1000);
        localStorage.setItem('hunt_history', JSON.stringify(history));
    }

    document.getElementById('next-btn').onclick = () => {
        currentIdx++;
        if (currentIdx < currentSet.length) {
            showQuestion();
        } else {
            alert("æœ¬å–®å…ƒç·´ç¿’çµæŸï¼ç³»çµ±å·²æ›´æ–°ä½ çš„è¨˜æ†¶æ›²ç·šã€‚");
            location.reload();
        }
    };

    function confirmExit() {
        if (confirm("ç¢ºå®šè¦æ”¾æ£„ç›®å‰çš„é€²åº¦ä¸¦è¿”å›é¦–é å—ï¼Ÿ\n(æœªå®Œæˆçš„é¡Œç›®å°‡ä¸æœƒæ›´æ–°è¤‡ç¿’æ™‚é–“)")) {
            location.reload();
        }
    }

    init();
</script>
</body>
</html>
